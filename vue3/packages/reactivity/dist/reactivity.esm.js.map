{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/system.ts", "../src/ref.ts", "../src/index.ts"],
  "sourcesContent": ["export function isObject(value) {\r\n    return typeof value === 'object' && value !==null\r\n}", "export let activeSub\r\n\r\nclass ReactiveEffect {\r\n  constructor(public fn) {}\r\n\r\n  run() {\r\n    // \u5148\u5C06\u5F53\u524D\u7684effect\u4FDD\u5B58\u8D77\u6765\uFF0C\u7528\u6765\u5904\u7406\u5D4C\u5957\u7684\u903B\u8F91\r\n    const preSub = activeSub\r\n    activeSub = this\r\n    // activeSub()\r\n    try {\r\n      return this.fn()\r\n    } finally {\r\n      // \u6267\u884C\u5B8C\u6210\u540E\u628Aactivesub\u8BBE\u7F6E\u6210\u4E4B\u524D\u7684effect\r\n      activeSub = preSub\r\n    }\r\n  }\r\n\r\n  notify() {\r\n    this.scheduler()\r\n  }\r\n\r\n  scheduler() {\r\n    this.run()\r\n  }\r\n}\r\nexport function effect(fn, options) {\r\n  const e = new ReactiveEffect(fn)\r\n  // scheduler\r\n  Object.assign(e, options)\r\n  e.run()\r\n\r\n  const runner = () => e.run()\r\n  runner.effect = e\r\n  return runner\r\n}\r\n", "/**\r\n * \u8FDE\u63A5\u94FE\u8868\u5173\u7CFB\r\n * @param deep \r\n * @param sub \r\n */\r\nexport function link(deep, sub) {\r\n  const newLink = {\r\n    sub,\r\n    nextSub: undefined,\r\n    preSub: undefined,\r\n  }\r\n  if (deep.subsTail) {\r\n    // \u5F80\u540E\u9762\u52A0\r\n    deep.subsTail.nextSub = newLink\r\n    newLink.preSub = deep.subsTail\r\n    deep.subsTail = newLink\r\n  } else {\r\n    // \u5934\u8282\u70B9\u4E5F\u6CA1\u6709 \u5934\u5C3E\u662F\u540C\u4E00\u4E2A\r\n    deep.subs = newLink\r\n    deep.subsTail = newLink\r\n  }\r\n}\r\n\r\nexport function progagate(subs) {\r\n  let link = subs\r\n  let queueEffect = []\r\n  while (link) {\r\n    queueEffect.push(link.sub)\r\n    link = link.nextSub\r\n  }\r\n  console.log(subs)\r\n  // console.log('quequEffect', quequEffect)\r\n\r\n  queueEffect.forEach(effect => effect.notify())\r\n}\r\n\r\n/**\r\n * \u94FE\u8868\u8282\u70B9\r\n */\r\nexport interface Link {\r\n  // \u4FDD\u5B58effect\r\n  sub: Function\r\n  // \u4E0B\u4E00\u4E2A\u8282\u70B9\r\n  nextSub: Link | undefined\r\n  // \u4E0A\u4E00\u4E2A\u8282\u70B9\r\n  preSub: Link | undefined\r\n}", "import { activeSub } from './effect'\r\nimport { Link, link, progagate } from './system';\r\n\r\nenum ReactiveFlags {\r\n  IS_REF = '__v_isRef',\r\n}\r\n\r\n\r\n\r\n/**\r\n * REF\u7C7B\r\n */\r\nclass RefImpl {\r\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\r\n  _value;\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  // \u4FDD\u5B58\u548Ceffect\u4E4B\u95F4\u7684\u5173\u7CFB\r\n  /**\r\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n   */\r\n  subs: Link\r\n\r\n  /**\r\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u6211\u4EEC\u8BB2\u7684tail\r\n   */\r\n  subsTail: Link\r\n  constructor(value) {\r\n    this._value = value\r\n  }\r\n\r\n  get value() {\r\n    // \u6536\u96C6\u4F9D\u8D56\r\n    // console.log('\u6709\u4EBA\u8BBF\u95EE\u6211\u4E86')\r\n    if (activeSub) {\r\n      // this.subs = activeSub\r\n      trackRef(this)\r\n    }\r\n    return this._value\r\n  }\r\n\r\n  set value(newValue) {\r\n    // \u89E6\u53D1\u66F4\u65B0\r\n    // console.log('\u6211\u7684\u503C\u53D8\u4E86')\r\n    this._value = newValue\r\n\r\n    // \u901A\u77E5EFFECT\u91CD\u65B0\u6267\u884C\r\n    // this.subs?.()\r\n\r\n    traggerRef(this)\r\n  }\r\n}\r\nexport function ref(value) {\r\n  return new RefImpl(value)\r\n}\r\n\r\n/**\r\n * \u5224\u65AD\u662F\u4E0D\u662F\u4E00\u4E2AREF\r\n * @param value\r\n * @returns\r\n */\r\nexport function isRef(value) {\r\n  return !!(value && value[ReactiveFlags.IS_REF])\r\n}\r\n\r\n/**\r\n * \u5EFA\u7ACBref\u548Ceffect\u94FE\u8868\u95F4\u7684\u5173\u7CFB\r\n * @param deep\r\n */\r\nexport function trackRef(deep) {\r\n  if (activeSub) {\r\n    link(deep, activeSub)\r\n  }\r\n}\r\n\r\n/**\r\n * \u89E6\u53D1\u5173\u8054\u7684effect\u91CD\u65B0\u6267\u884C\r\n * @param deep\r\n */\r\nexport function traggerRef(deep) {\r\n  if (deep.subs) {\r\n    progagate(deep.subs)\r\n  }\r\n}\r\n\r\n\r\n", "import { isObject } from \"@vue/shared\"\r\n\r\nexport function fn(a,b){\r\n    return a+b\r\n}\r\nexport * from './ref'\r\nexport * from './effect'\r\n\r\nisObject({})"],
  "mappings": ";AAAO,SAAS,SAAS,OAAO;AAC5B,SAAO,OAAO,UAAU,YAAY,UAAS;AACjD;;;ACFO,IAAI;AAEX,IAAM,iBAAN,MAAqB;AAAA,EACnB,YAAmBA,KAAI;AAAJ,cAAAA;AAAA,EAAK;AAAA,EAExB,MAAM;AAEJ,UAAM,SAAS;AACf,gBAAY;AAEZ,QAAI;AACF,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AAEA,kBAAY;AAAA,IACd;AAAA,EACF;AAAA,EAEA,SAAS;AACP,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,YAAY;AACV,SAAK,IAAI;AAAA,EACX;AACF;AACO,SAAS,OAAOA,KAAI,SAAS;AAClC,QAAM,IAAI,IAAI,eAAeA,GAAE;AAE/B,SAAO,OAAO,GAAG,OAAO;AACxB,IAAE,IAAI;AAEN,QAAM,SAAS,MAAM,EAAE,IAAI;AAC3B,SAAO,SAAS;AAChB,SAAO;AACT;;;AC9BO,SAAS,KAAK,MAAM,KAAK;AAC9B,QAAM,UAAU;AAAA,IACd;AAAA,IACA,SAAS;AAAA,IACT,QAAQ;AAAA,EACV;AACA,MAAI,KAAK,UAAU;AAEjB,SAAK,SAAS,UAAU;AACxB,YAAQ,SAAS,KAAK;AACtB,SAAK,WAAW;AAAA,EAClB,OAAO;AAEL,SAAK,OAAO;AACZ,SAAK,WAAW;AAAA,EAClB;AACF;AAEO,SAAS,UAAU,MAAM;AAC9B,MAAIC,QAAO;AACX,MAAI,cAAc,CAAC;AACnB,SAAOA,OAAM;AACX,gBAAY,KAAKA,MAAK,GAAG;AACzB,IAAAA,QAAOA,MAAK;AAAA,EACd;AACA,UAAQ,IAAI,IAAI;AAGhB,cAAY,QAAQ,CAAAC,YAAUA,QAAO,OAAO,CAAC;AAC/C;;;ACtBA,IAAM,UAAN,MAAc;AAAA;AAAA,EAEZ;AAAA,EACA,CAAC,wBAAoB,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAMzB;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA,EACA,YAAY,OAAO;AACjB,SAAK,SAAS;AAAA,EAChB;AAAA,EAEA,IAAI,QAAQ;AAGV,QAAI,WAAW;AAEb,eAAS,IAAI;AAAA,IACf;AACA,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,MAAM,UAAU;AAGlB,SAAK,SAAS;AAKd,eAAW,IAAI;AAAA,EACjB;AACF;AACO,SAAS,IAAI,OAAO;AACzB,SAAO,IAAI,QAAQ,KAAK;AAC1B;AAOO,SAAS,MAAM,OAAO;AAC3B,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAoB;AAC/C;AAMO,SAAS,SAAS,MAAM;AAC7B,MAAI,WAAW;AACb,SAAK,MAAM,SAAS;AAAA,EACtB;AACF;AAMO,SAAS,WAAW,MAAM;AAC/B,MAAI,KAAK,MAAM;AACb,cAAU,KAAK,IAAI;AAAA,EACrB;AACF;;;ACjFO,SAAS,GAAG,GAAE,GAAE;AACnB,SAAO,IAAE;AACb;AAIA,SAAS,CAAC,CAAC;",
  "names": ["fn", "link", "effect"]
}
